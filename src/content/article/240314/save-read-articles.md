---
title: èª­ã‚“ã è¨˜äº‹ã‚’ã¨ã«ã‹ããƒ­ã‚°ã‚‹é‹ç”¨
date: 2024-03-14
tags: kintone IT
eyecatch: 240314.jpg
eyecatchEmoji: ğŸ“š
description: èª¿ã¹ç‰©ã‚„æš‡ã¤ã¶ã—ã¨ã—ã¦ä½•æ°—ãªãèª­ã‚“ã§ã‚‹ãƒãƒƒãƒˆã®è¨˜äº‹ã‚’å…¨éƒ¨è¨˜éŒ²ã¨ã—ã¦æ®‹ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã€ãã®åœŸå£Œã‚’æ•´å‚™ã—ã¾ã—ãŸã€‚
---

ã“ã‚“ã«ã¡ã¯ã€‚ã ã„ã¡ã‚ƒã‚“ã§ã™ã€‚

[å›ãŸã¡ã¯ã©ã†è¨˜äº‹ã‚’ç®¡ç†ã—ã¦ã„ã‚‹ã‹](https://zenn.dev/yokoo_an209/articles/c0ccd3bd241ad6)

ğŸ‘†ã“ã®è¨˜äº‹ã«æ„ŸåŒ–ã•ã‚Œã¦ã€åƒ•ã‚‚èª­ã‚“ã è¨˜äº‹ã‚’ã¨ã‚Šã‚ãˆãšå…¨éƒ¨è¨˜éŒ²ã™ã‚‹æ´»å‹•ã‚’åˆã‚ã¦ã¿ã‚ˆã†ã¨æ€ã„ã€kintoneã‚¢ãƒ—ãƒªã¨ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã§è¨˜éŒ²ã™ã‚‹ç’°å¢ƒã‚’ä½œã‚Šã¾ã—ãŸã€‚

## ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã§kintoneã«è¨˜äº‹ã‚’ä¿å­˜ã™ã‚‹

ã“ã®æ‰‹ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ã„ã‹ã«è² æ‹…ãªãä½¿ã„ç¶šã‘ã‚‰ã‚Œã‚‹ã‹ã€ãŒé‡è¦ã«ãªã£ã¦ãã‚‹ã®ã§ã€ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã¨URLã‚’kintoneã«é£›ã°ã™ãŸã‚ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨ã€kintoneå´ã§ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’ä½œæˆã—ã¾ã—ãŸã€‚

![](/images/240314.jpg)

è¨˜äº‹ã‚’ä¿å­˜ã™ã‚‹éš›ã®æ“ä½œæ‰‹é †ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

1. è¨˜äº‹ã‚’é–‹ã„ãŸçŠ¶æ…‹ã§ã€ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ã€Œè¨˜äº‹ä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ï¼ˆç”»åƒã®èµ¤æ ã®ã‚„ã¤ï¼‰
2. kintoneã®ãƒ¬ã‚³ãƒ¼ãƒ‰è¿½åŠ ç”»é¢ãŒç«‹ã¡ä¸ŠãŒã‚Šã€ã‚¿ã‚¤ãƒˆãƒ«ã¨URLãŒè‡ªå‹•æŒ¿å…¥ã•ã‚Œã‚‹
3. è¨˜äº‹ã«é–¢é€£ã™ã‚‹ã‚¿ã‚°ã‚’é¸æŠã—ã¦ã€ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹
4. 2. ã§é–‹ã„ãŸç”»é¢ãŒé–‰ã˜ã‚‹


## ãƒãƒ¼ãƒ‰ãƒ«ã‚’ä½ãã™ã‚‹ãŸã‚ã®ã“ã ã‚ã‚Š

### ã‚¿ã‚¤ãƒˆãƒ«ã¨URLã®è‡ªå‹•å…¥åŠ›

ã‚ã–ã‚ã–ã‚³ãƒ”ãƒšã™ã‚‹ãªã‚“ã¦ã‚„ã£ã¦ã‚‰ã‚Œãªã„ã®ã§ã€‚


### ãƒ¬ã‚³ãƒ¼ãƒ‰ä¿å­˜æ™‚ã«ã‚¿ãƒ–ã‚’é–‰ã˜ã‚‹

æœ¬æ¥ãªã‚‰ãƒ¬ã‚³ãƒ¼ãƒ‰ä¸€è¦§ç”»é¢ã«ç§»å‹•ã™ã‚‹ã¨ã“ã‚ã‚’ã€ã‚¿ãƒ–ã‚’é–‰ã˜ã‚‹ã‚ˆã†ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã—ãŸã€‚

ä¿å­˜å¾Œã€é–²è¦§ã—ã¦ã„ãŸè¨˜äº‹ã«æˆ»ã‚‹æ‰‹é–“ã‚’æ¸›ã‚‰ã—ã¾ã™ã€‚


### ä¿å­˜ã—ãŸã‹ã©ã†ã‹ãŒã‚ã‹ã‚‹ã‚ˆã†ã«

ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ç‚¹ã§ã€é–²è¦§ã—ã¦ã„ãŸè¨˜äº‹ã®ã‚¿ãƒ–ãŒ âœ… ã«å¤‰ã‚ã‚‹ã®ã§ã€äºŒé‡ç™»éŒ²ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

ä¿å­˜ã—ãŸã£...ã‘ï¼Ÿï¼Ÿã£ã¦æ‚©ã‚€ã“ã¨ã™ã‚‰ã‚ã‚“ã©ãã•ã„ã€‚


## ã‚³ãƒ¼ãƒ‰

â–¼ ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ

```javascript
javascript:(function(){t=window.getSelection().toString() ? window.getSelection().toString() : document.title;u=document.URL;window.open('https://udcxx.cybozu.com/k/guest/4/20/edit?title=' + t.replaceAll(' ','_space_').replaceAll('#','_hash_').replaceAll('?','_question_').replaceAll('%','_par_') + '&url=' + u); document.title = 'âœ…'})();
```

â–¼ kintoneã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

```javascript
const spaceId = 'tags';
const ignoreField = ['Read']

kintone.events.on('app.record.create.show', (event) => {
    const searchParams = new URLSearchParams(window.location.search);
    event.record.Title.value = searchParams.has('title') ? searchParams.get('title').replaceAll('_space_',' ').replaceAll('_hash_','#').replaceAll('_question_','?').replaceAll('_par_','%') : '';
    event.record.URL.value = searchParams.has('url') ? searchParams.get('url') : '';
    event = createSelector(event);
    return event;
});

kintone.events.on(['app.record.edit.show', 'app.record.detail.show'], (event) => {
    return createSelector(event);
});

kintone.events.on('app.record.create.submit.success', () => {
    window.close();
});



/**
 * ã‚¿ã‚°ã‚’é¸æŠã™ã‚‹ç”»é¢ã‚’ç”Ÿæˆã—ã¾ã™
 * 
 * @param {Object} event ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 * @returns ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 */
async function createSelector(event) {

    const appId = kintone.app.getId();

    const fieldInfo = await kintone.api(kintone.api.url('/k/v1/app/form/fields', true), 'GET', {app: appId});
    const fieldLayout = await kintone.api(kintone.api.url('/k/v1/app/form/layout', true), 'GET', {app: appId});

    await Promise.all(
        fieldLayout.layout.map((row) => {
            if (row.type === 'ROW') {
                const type = row.fields[0].type;
                const field = row.fields[0].code;
                if (type === 'CHECK_BOX' && !ignoreField.includes(field)) {
                    // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ ã‹ã¤ ignoreã«å«ã¾ã‚Œãªã„

                    let ul = document.createElement('ul');
                    ul.classList.add('udcxx-tags');

                    const options = Object.keys(fieldInfo.properties[field].options);
                    options.forEach((option) => {
                        const label = fieldInfo.properties[field].options[option].label;
                        let li = document.createElement('li');
                        li.classList.add('udcxx-tag');
                        li.innerHTML = replaceIcon(label);

                        if (event.type === 'app.record.detail.show') {
                            li.style.display = 'none';
                        }

                        if (event.record[field].value.includes(label)) {
                            li.classList.add('--selected');

                            if (event.type === 'app.record.detail.show') {
                                li.style.display = 'block';
                            }
                        }

                        if (event.type === 'app.record.create.show' || event.type === 'app.record.edit.show') {
                            li.style.cursor = 'pointer';

                            li.addEventListener('click', () => {
                                li.classList.toggle('--selected');
                                changeValue(field, option, li.classList.contains('--selected'));
                            });
                        }
                        ul.appendChild(li);
                    });

                    kintone.app.record.getSpaceElement(spaceId).appendChild(ul);

                    kintone.app.record.setFieldShown(field, false)
                }
            }
        })
    )

    return event;
}

/**
 * ã‚¿ã‚°é¸æŠæ™‚ã«ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’å¤‰æ›´ã—ã¾ã™
 * 
 * @param {String} fieldCode å¤‰æ›´ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚³ãƒ¼ãƒ‰
 * @param {String} value å¤‰æ›´ã™ã‚‹å€¤
 * @param {Boolean} isSelect é¸æŠçŠ¶æ…‹ã«ã™ã‚‹å ´åˆã€true
 */
function changeValue(fieldCode, value, isSelect) {
    const recordObject = kintone.app.record.get();
    const targetArray = recordObject.record[fieldCode].value;

    if (targetArray.includes(value) && !isSelect) {
        // é¸æŠæ¸ˆã¿ && é¸æŠè§£é™¤ã—ãŸã„
        recordObject.record[fieldCode].value = targetArray.filter(v => v !== value);
    } else if (!targetArray.includes(value) && isSelect) {
        // æœªé¸æŠã®å ´åˆ && é¸æŠã—ãŸã„
        recordObject.record[fieldCode].value.push(value);
    }

    kintone.app.record.set(recordObject);
}

/**
 * :iconName: ã‚’ç”»åƒè¦ç´ ã«å¤‰æ›
 * 
 * @param {String} valueText :iconName: ItemValue
 * @returns :iconName: ã«å¯¾å¿œã—ãŸç”»åƒè¦ç´ ãŒå«ã¾ã‚Œã‚‹ã‚¢ã‚¤ãƒ†ãƒ 
 */
function replaceIcon(valueText) {
    if (valueText.includes(':')) {
        const iconName = valueText.match(/:.*:/g)[0].replaceAll(':','');
        const iconDom = `<img src="https://xxxx/icon/${iconName}.svg" class="udcxx-icon">`;
    
        return valueText.replace(':'+ iconName + ':', iconDom);
    }

    return valueText;
}
```

```css
.udcxx-icon {
    width: 1.5em; height: 1.5em;
    padding-right: 3px;
    top: -0.1em;
    position: relative;
    vertical-align: middle;
}

.udcxx-tags {
    max-width: 80vw;
    margin-bottom: 20px;
    padding-inline-start: 0; padding-left: 8px;
    display: flex;
    justify-content: flex-start;
    flex-wrap: wrap;
    list-style: none;
}

.udcxx-tag {
    margin: 5px;
    padding: 5px 10px;
    color: #333;
    border-radius: 5px;
    border: 1px solid #999;
    background-color: #ededed;
}

.udcxx-tag.--selected {
    color: #fff;
    border: 1px solid #999;
    background-color: #3498db;
}
```

---

ã“ã“ã«è“„ç©ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã©ã£ã‹ï¼ˆãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã¨ã‹ï¼‰ã§æ´»ç”¨ã—ãŸã„ãªã...